{"version":3,"sources":["../../src/prisma/prisma.service.ts"],"sourcesContent":["import { Injectable, OnModuleInit, OnModuleDestroy } from '@nestjs/common';\r\nimport { PrismaClient } from '@prisma/client';\r\n\r\n@Injectable()\r\nexport class PrismaService\r\n  extends PrismaClient\r\n  implements OnModuleInit, OnModuleDestroy {\r\n  constructor() {\r\n    super({\r\n      log: process.env.NODE_ENV === 'production'\r\n        ? ['error']\r\n        : ['query', 'error', 'warn'],\r\n    });\r\n  }\r\n\r\n  async onModuleInit() {\r\n    await this.$connect();\r\n    console.log('âœ… Database connected successfully');\r\n  }\r\n\r\n  async onModuleDestroy() {\r\n    await this.$disconnect();\r\n    console.log('ðŸ‘‹ Database disconnected');\r\n  }\r\n\r\n  // Clean database (for testing)\r\n  async cleanDatabase() {\r\n    if (process.env.NODE_ENV === 'production') {\r\n      throw new Error('Cannot clean database in production');\r\n    }\r\n\r\n    const models = Reflect.ownKeys(this).filter((key) =>\r\n      key.toString().startsWith('_'),\r\n    );\r\n\r\n    return Promise.all(\r\n      models.map((modelKey) => {\r\n        const model = this[modelKey as keyof PrismaService] as any;\r\n        if (model && typeof model.deleteMany === 'function') {\r\n          return model.deleteMany();\r\n        }\r\n      }),\r\n    );\r\n  }\r\n}\r\n"],"names":["PrismaService","PrismaClient","onModuleInit","$connect","console","log","onModuleDestroy","$disconnect","cleanDatabase","process","env","NODE_ENV","Error","models","Reflect","ownKeys","filter","key","toString","startsWith","Promise","all","map","modelKey","model","deleteMany"],"mappings":";;;;+BAIaA;;;eAAAA;;;wBAJ6C;wBAC7B;;;;;;;;;;AAGtB,IAAA,AAAMA,gBAAN,MAAMA,sBACHC,oBAAY;IAUpB,MAAMC,eAAe;QACnB,MAAM,IAAI,CAACC,QAAQ;QACnBC,QAAQC,GAAG,CAAC;IACd;IAEA,MAAMC,kBAAkB;QACtB,MAAM,IAAI,CAACC,WAAW;QACtBH,QAAQC,GAAG,CAAC;IACd;IAEA,+BAA+B;IAC/B,MAAMG,gBAAgB;QACpB,IAAIC,QAAQC,GAAG,CAACC,QAAQ,KAAK,cAAc;YACzC,MAAM,IAAIC,MAAM;QAClB;QAEA,MAAMC,SAASC,QAAQC,OAAO,CAAC,IAAI,EAAEC,MAAM,CAAC,CAACC,MAC3CA,IAAIC,QAAQ,GAAGC,UAAU,CAAC;QAG5B,OAAOC,QAAQC,GAAG,CAChBR,OAAOS,GAAG,CAAC,CAACC;YACV,MAAMC,QAAQ,IAAI,CAACD,SAAgC;YACnD,IAAIC,SAAS,OAAOA,MAAMC,UAAU,KAAK,YAAY;gBACnD,OAAOD,MAAMC,UAAU;YACzB;QACF;IAEJ;IApCA,aAAc;QACZ,KAAK,CAAC;YACJpB,KAAKI,QAAQC,GAAG,CAACC,QAAQ,KAAK,eAC1B;gBAAC;aAAQ,GACT;gBAAC;gBAAS;gBAAS;aAAO;QAChC;IACF;AA+BF"}