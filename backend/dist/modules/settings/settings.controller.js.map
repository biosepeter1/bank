{"version":3,"sources":["../../../src/modules/settings/settings.controller.ts"],"sourcesContent":["import { Controller, Get, Put, Body, UseGuards, Post } from '@nestjs/common';\nimport { ApiTags, ApiOperation, ApiBearerAuth } from '@nestjs/swagger';\nimport { SettingsService } from './settings.service';\nimport { JwtAuthGuard } from '../../common/guards/jwt-auth.guard';\nimport { RolesGuard } from '../../common/guards/roles.guard';\nimport { Roles } from '../../common/decorators/roles.decorator';\nimport { UpdateSettingsDto } from './dto/update-settings.dto';\nimport { EmailService } from '../../common/services/email.service';\nimport { AllowSuspended } from '../../common/decorators/allow-suspended.decorator';\n\n@ApiTags('settings')\n@Controller('settings')\nexport class SettingsController {\n  constructor(private readonly settingsService: SettingsService, private readonly email: EmailService) { }\n\n  @Get()\n  @AllowSuspended()\n  @ApiOperation({ summary: 'Get all system settings - Public endpoint' })\n  getSettings() {\n    return this.settingsService.getSettings();\n  }\n\n  @Put()\n  @UseGuards(JwtAuthGuard, RolesGuard)\n  @Roles('BANK_ADMIN', 'SUPER_ADMIN')\n  @ApiBearerAuth()\n  @ApiOperation({ summary: 'Update system settings - Admin only' })\n  updateSettings(@Body() updateSettingsDto: UpdateSettingsDto) {\n    return this.settingsService.updateSettings(updateSettingsDto);\n  }\n\n  @Post('test-email')\n  @UseGuards(JwtAuthGuard, RolesGuard)\n  @Roles('BANK_ADMIN', 'SUPER_ADMIN')\n  @ApiBearerAuth()\n  @ApiOperation({ summary: 'Send a test email using current SMTP settings' })\n  async testEmail(@Body('to') to: string) {\n    const settings = await this.settingsService.getSettings();\n    const dest = to || settings.general.supportEmail;\n    await this.email.sendGenericNotification({\n      email: dest,\n      title: 'Test Email',\n      message: 'If you received this, SMTP is configured correctly.',\n    });\n    return { success: true, to: dest };\n  }\n}\n"],"names":["SettingsController","getSettings","settingsService","updateSettings","updateSettingsDto","testEmail","to","settings","dest","general","supportEmail","email","sendGenericNotification","title","message","success","summary"],"mappings":";;;;+BAYaA;;;eAAAA;;;wBAZ+C;yBACP;iCACrB;8BACH;4BACF;gCACL;mCACY;8BACL;yCACE;;;;;;;;;;;;;;;AAIxB,IAAA,AAAMA,qBAAN,MAAMA;IAMXC,cAAc;QACZ,OAAO,IAAI,CAACC,eAAe,CAACD,WAAW;IACzC;IAOAE,eAAe,AAAQC,iBAAoC,EAAE;QAC3D,OAAO,IAAI,CAACF,eAAe,CAACC,cAAc,CAACC;IAC7C;IAEA,MAKMC,UAAU,AAAYC,EAAU,EAAE;QACtC,MAAMC,WAAW,MAAM,IAAI,CAACL,eAAe,CAACD,WAAW;QACvD,MAAMO,OAAOF,MAAMC,SAASE,OAAO,CAACC,YAAY;QAChD,MAAM,IAAI,CAACC,KAAK,CAACC,uBAAuB,CAAC;YACvCD,OAAOH;YACPK,OAAO;YACPC,SAAS;QACX;QACA,OAAO;YAAEC,SAAS;YAAMT,IAAIE;QAAK;IACnC;IAhCA,YAAY,AAAiBN,eAAgC,EAAE,AAAiBS,KAAmB,CAAE;aAAxET,kBAAAA;aAAmDS,QAAAA;IAAuB;AAiCzG;;;;;QA7BkBK,SAAS;;;;;;;;;;;;QASTA,SAAS;;;;;;;;;;;;;;;QASTA,SAAS"}