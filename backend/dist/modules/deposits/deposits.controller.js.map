{"version":3,"sources":["../../../src/modules/deposits/deposits.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Post,\n  Get,\n  Patch,\n  Delete,\n  Body,\n  Param,\n  UseGuards,\n  UseInterceptors,\n  UploadedFile,\n  HttpCode,\n  HttpStatus,\n  Request,\n  BadRequestException,\n} from '@nestjs/common';\nimport { FileInterceptor } from '@nestjs/platform-express';\nimport { DepositsService } from './deposits.service';\nimport { JwtAuthGuard } from '@/common/guards/jwt-auth.guard';\nimport { RolesGuard } from '@/common/guards/roles.guard';\nimport { Roles } from '@/common/decorators/roles.decorator';\nimport { CreateDepositDto, ConfirmDepositDto, UploadDepositProofDto } from './dto/create-deposit.dto';\nimport { ApiTags, ApiOperation, ApiBearerAuth, ApiConsumes, ApiBody } from '@nestjs/swagger';\n\n@ApiTags('Deposits')\n@ApiBearerAuth()\n@UseGuards(JwtAuthGuard)\n@Controller('deposits')\nexport class DepositsController {\n  constructor(private depositsService: DepositsService) {}\n\n  /**\n   * Initiate a new deposit\n   */\n  @Post('initiate')\n  @HttpCode(HttpStatus.CREATED)\n  @ApiOperation({ summary: 'Initiate a new deposit' })\n  async initiateDeposit(@Request() req, @Body() createDepositDto: CreateDepositDto) {\n    const userId = req.user.id;\n    return this.depositsService.initiateDeposit(userId, createDepositDto);\n  }\n\n  /**\n   * Confirm a Paystack deposit\n   */\n  @Post('confirm')\n  @HttpCode(HttpStatus.OK)\n  @ApiOperation({ summary: 'Confirm a Paystack deposit' })\n  async confirmDeposit(@Request() req, @Body() confirmDepositDto: ConfirmDepositDto) {\n    return this.depositsService.confirmPaystackDeposit(confirmDepositDto.reference);\n  }\n\n  /**\n   * Get deposit history\n   */\n  @Get('history')\n  @ApiOperation({ summary: 'Get user deposit history' })\n  async getDepositHistory(\n    @Request() req,\n  ) {\n    const userId = req.user.id;\n    return this.depositsService.getDepositHistory(userId);\n  }\n\n  /**\n   * Get specific deposit details\n   */\n  @Get(':depositId')\n  @ApiOperation({ summary: 'Get deposit details' })\n  async getDepositById(\n    @Request() req,\n    @Param('depositId') depositId: string,\n  ) {\n    const userId = req.user.id;\n    return this.depositsService.getDepositById(userId, depositId);\n  }\n\n  /**\n   * Delete deposit (User can delete their own deposit history)\n   */\n  @Delete(':depositId')\n  @ApiOperation({ summary: 'Delete deposit from history' })\n  async deleteDeposit(\n    @Request() req,\n    @Param('depositId') depositId: string,\n  ) {\n    const userId = req.user.id;\n    return this.depositsService.deleteDeposit(userId, depositId);\n  }\n\n  /**\n   * Upload deposit proof for manual deposits\n   */\n  @Post(':depositId/upload-proof')\n  @UseInterceptors(FileInterceptor('file'))\n  @ApiConsumes('multipart/form-data')\n  @ApiBody({\n    description: 'File to upload',\n    type: 'multipart/form-data',\n    schema: {\n      type: 'object',\n      properties: {\n        file: {\n          type: 'string',\n          format: 'binary',\n        },\n      },\n    },\n  })\n  @ApiOperation({ summary: 'Upload deposit proof' })\n  async uploadDepositProof(\n    @Request() req,\n    @Param('depositId') depositId: string,\n    @UploadedFile() file: any,\n  ) {\n    if (!file) {\n      throw new BadRequestException('No file uploaded');\n    }\n    const userId = req.user.id;\n    return this.depositsService.uploadDepositProof(userId, depositId, file);\n  }\n\n  /**\n   * Admin: Get all deposits\n   */\n  @Get('admin/all')\n  @UseGuards(RolesGuard)\n  @Roles('BANK_ADMIN', 'SUPER_ADMIN')\n  @ApiOperation({ summary: 'Get all deposits (Admin only)' })\n  async getAllDeposits() {\n    return this.depositsService.getAllDeposits();\n  }\n\n  /**\n   * Admin: Approve deposit\n   */\n  @Patch('admin/:depositId/approve')\n  @UseGuards(RolesGuard)\n  @Roles('BANK_ADMIN', 'SUPER_ADMIN')\n  @ApiOperation({ summary: 'Approve deposit (Admin only)' })\n  async approveDeposit(\n    @Param('depositId') depositId: string,\n    @Request() req,\n  ) {\n    const adminId = req.user.id;\n    return this.depositsService.approveDeposit(depositId, adminId);\n  }\n\n  /**\n   * Admin: Reject deposit\n   */\n  @Patch('admin/:depositId/reject')\n  @UseGuards(RolesGuard)\n  @Roles('BANK_ADMIN', 'SUPER_ADMIN')\n  @ApiOperation({ summary: 'Reject deposit (Admin only)' })\n  async rejectDeposit(\n    @Param('depositId') depositId: string,\n    @Body() body: { reason?: string },\n    @Request() req,\n  ) {\n    const adminId = req.user.id;\n    return this.depositsService.rejectDeposit(depositId, adminId, body.reason);\n  }\n\n  /**\n   * Admin: Delete deposit\n   */\n  @Delete('admin/:depositId')\n  @UseGuards(RolesGuard)\n  @Roles('BANK_ADMIN', 'SUPER_ADMIN')\n  @ApiOperation({ summary: 'Delete deposit (Admin only)' })\n  async adminDeleteDeposit(\n    @Param('depositId') depositId: string,\n    @Request() req,\n  ) {\n    const adminId = req.user.id;\n    return this.depositsService.adminDeleteDeposit(depositId, adminId);\n  }\n}\n"],"names":["DepositsController","initiateDeposit","req","createDepositDto","userId","user","id","depositsService","confirmDeposit","confirmDepositDto","confirmPaystackDeposit","reference","getDepositHistory","getDepositById","depositId","deleteDeposit","uploadDepositProof","file","BadRequestException","getAllDeposits","approveDeposit","adminId","rejectDeposit","body","reason","adminDeleteDeposit","CREATED","summary","OK","description","type","schema","properties","format"],"mappings":"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"}