{"version":3,"sources":["../../../src/modules/auth/auth.controller.ts"],"sourcesContent":["import { Controller, Post, Body, Get, UseGuards, HttpCode, HttpStatus, Patch } from '@nestjs/common';\r\nimport { ApiTags, ApiOperation, ApiResponse, ApiBearerAuth } from '@nestjs/swagger';\r\nimport { AuthService } from './auth.service';\r\nimport { RegisterDto } from './dto/register.dto';\r\nimport { LoginDto, LoginResponseDto } from './dto/login.dto';\r\nimport { ChangePasswordDto } from './dto/change-password.dto';\r\nimport { JwtAuthGuard } from '../../common/guards/jwt-auth.guard';\r\nimport { CurrentUser } from '../../common/decorators/current-user.decorator';\r\nimport { AllowSuspended } from '../../common/decorators/allow-suspended.decorator';\r\nimport { ForgotPasswordDto, ResetPasswordDto } from './dto/reset.dto';\r\n\r\n@ApiTags('auth')\r\n@Controller('auth')\r\nexport class AuthController {\r\n  constructor(private readonly authService: AuthService) {}\r\n\r\n  @Post('register')\r\n  @ApiOperation({ summary: 'Register a new user' })\r\n  @ApiResponse({ \r\n    status: 201, \r\n    description: 'User successfully registered',\r\n    type: LoginResponseDto\r\n  })\r\n  @ApiResponse({ status: 409, description: 'Email or phone already registered' })\r\n  async register(@Body() registerDto: RegisterDto) {\r\n    return this.authService.register(registerDto);\r\n  }\r\n\r\n  @Post('login')\r\n  @HttpCode(HttpStatus.OK)\r\n  @ApiOperation({ summary: 'Login user' })\r\n  @ApiResponse({ \r\n    status: 200, \r\n    description: 'User successfully logged in',\r\n    type: LoginResponseDto\r\n  })\r\n  @ApiResponse({ status: 401, description: 'Invalid credentials' })\r\n  async login(@Body() loginDto: LoginDto) {\r\n    return this.authService.login(loginDto);\r\n  }\r\n\r\n  @Post('refresh')\r\n  @HttpCode(HttpStatus.OK)\r\n  @ApiOperation({ summary: 'Refresh access token' })\r\n  @ApiResponse({ status: 200, description: 'Token refreshed successfully' })\r\n  @ApiResponse({ status: 401, description: 'Invalid refresh token' })\r\n  async refresh(@Body('refreshToken') refreshToken: string) {\r\n    return this.authService.refreshToken(refreshToken);\r\n  }\r\n\r\n  @Get('me')\r\n  @UseGuards(JwtAuthGuard)\r\n  @AllowSuspended() // Suspended users can view their profile\r\n  @ApiBearerAuth()\r\n  @ApiOperation({ summary: 'Get current user profile' })\r\n  @ApiResponse({ status: 200, description: 'User profile retrieved' })\r\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\r\n  async getProfile(@CurrentUser() user: any) {\r\n    return this.authService.validateUser(user.id);\r\n  }\r\n\r\n  @Post('forgot-password')\r\n  @HttpCode(HttpStatus.OK)\r\n  @ApiOperation({ summary: 'Start password reset (email OTP)' })\r\n  async forgot(@Body() dto: ForgotPasswordDto) {\r\n    return this.authService.forgotPassword(dto);\r\n  }\r\n\r\n  @Post('reset-password')\r\n  @HttpCode(HttpStatus.OK)\r\n  @ApiOperation({ summary: 'Reset password with OTP' })\r\n  async reset(@Body() dto: ResetPasswordDto) {\r\n    return this.authService.resetPassword(dto);\r\n  }\r\n\r\n  @Patch('change-password')\r\n  @UseGuards(JwtAuthGuard)\r\n  @ApiBearerAuth()\r\n  @HttpCode(HttpStatus.OK)\r\n  @ApiOperation({ summary: 'Change user password' })\r\n  @ApiResponse({ status: 200, description: 'Password changed successfully' })\r\n  @ApiResponse({ status: 400, description: 'Bad request' })\r\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\r\n  async changePassword(\r\n    @CurrentUser() user: any,\r\n    @Body() changePasswordDto: ChangePasswordDto,\r\n  ) {\r\n    return this.authService.changePassword(user.id, changePasswordDto);\r\n  }\r\n\r\n  @Get('settings')\r\n  @UseGuards(JwtAuthGuard)\r\n  @AllowSuspended() // Suspended users can view their settings\r\n  @ApiBearerAuth()\r\n  @ApiOperation({ summary: 'Get user notification settings' })\r\n  @ApiResponse({ status: 200, description: 'User settings retrieved' })\r\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\r\n  async getSettings(@CurrentUser() user: any) {\r\n    return this.authService.getUserSettings(user.id);\r\n  }\r\n\r\n  @Patch('settings')\r\n  @UseGuards(JwtAuthGuard)\r\n  @AllowSuspended() // Suspended users can update notification settings\r\n  @ApiBearerAuth()\r\n  @HttpCode(HttpStatus.OK)\r\n  @ApiOperation({ summary: 'Update user notification settings' })\r\n  @ApiResponse({ status: 200, description: 'Settings updated successfully' })\r\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\r\n  async updateSettings(\r\n    @CurrentUser() user: any,\r\n    @Body() settings: {\r\n      emailTransactions?: boolean;\r\n      emailSecurity?: boolean;\r\n      emailMarketing?: boolean;\r\n      smsTransactions?: boolean;\r\n      smsSecurity?: boolean;\r\n      pushNotifications?: boolean;\r\n    },\r\n  ) {\r\n    return this.authService.updateUserSettings(user.id, settings);\r\n  }\r\n\r\n  @Post('send-verification-email')\r\n  @UseGuards(JwtAuthGuard)\r\n  @AllowSuspended()\r\n  @ApiBearerAuth()\r\n  @HttpCode(HttpStatus.OK)\r\n  @ApiOperation({ summary: 'Send email verification code' })\r\n  @ApiResponse({ status: 200, description: 'Verification email sent' })\r\n  @ApiResponse({ status: 400, description: 'Email already verified' })\r\n  async sendVerificationEmail(@CurrentUser() user: any) {\r\n    return this.authService.sendVerificationEmail(user.id);\r\n  }\r\n\r\n  @Post('verify-email')\r\n  @UseGuards(JwtAuthGuard)\r\n  @AllowSuspended()\r\n  @ApiBearerAuth()\r\n  @HttpCode(HttpStatus.OK)\r\n  @ApiOperation({ summary: 'Verify email with OTP code' })\r\n  @ApiResponse({ status: 200, description: 'Email verified successfully' })\r\n  @ApiResponse({ status: 400, description: 'Invalid or expired code' })\r\n  async verifyEmail(\r\n    @CurrentUser() user: any,\r\n    @Body() body: { otpId: string; code: string },\r\n  ) {\r\n    return this.authService.verifyEmail(user.id, body.otpId, body.code);\r\n  }\r\n}\r\n"],"names":["AuthController","register","registerDto","authService","login","loginDto","refresh","refreshToken","getProfile","user","validateUser","id","forgot","dto","forgotPassword","reset","resetPassword","changePassword","changePasswordDto","getSettings","getUserSettings","updateSettings","settings","updateUserSettings","sendVerificationEmail","verifyEmail","body","otpId","code","summary","status","description","type","LoginResponseDto","OK"],"mappings":"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"}