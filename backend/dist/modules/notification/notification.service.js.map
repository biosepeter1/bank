{"version":3,"sources":["../../../src/modules/notification/notification.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\r\nimport { PrismaService } from '../../prisma/prisma.service';\r\n\r\n@Injectable()\r\nexport class NotificationService {\r\n  constructor(private prisma: PrismaService) {}\r\n\r\n  async getUserNotifications(userId: string) {\r\n    const notifications = await this.prisma.notification.findMany({\r\n      where: { userId },\r\n      orderBy: { createdAt: 'desc' },\r\n      take: 50, // Limit to 50 most recent notifications\r\n    });\r\n    return notifications;\r\n  }\r\n\r\n  async markAsRead(notificationId: string, userId: string) {\r\n    const notification = await this.prisma.notification.findFirst({\r\n      where: { id: notificationId, userId },\r\n    });\r\n\r\n    if (!notification) {\r\n      throw new Error('Notification not found');\r\n    }\r\n\r\n    return this.prisma.notification.update({\r\n      where: { id: notificationId },\r\n      data: { isRead: true },\r\n    });\r\n  }\r\n\r\n  async markAllAsRead(userId: string) {\r\n    return this.prisma.notification.updateMany({\r\n      where: { userId, isRead: false },\r\n      data: { isRead: true },\r\n    });\r\n  }\r\n\r\n  async createNotification(\r\n    userId: string,\r\n    title: string,\r\n    message: string,\r\n    type: string = 'INFO',\r\n    metadata?: any,\r\n  ) {\r\n    return this.prisma.notification.create({\r\n      data: {\r\n        userId,\r\n        title,\r\n        message,\r\n        type,\r\n        metadata,\r\n      },\r\n    });\r\n  }\r\n\r\n  async getUnreadCount(userId: string): Promise<number> {\r\n    return this.prisma.notification.count({\r\n      where: { userId, isRead: false },\r\n    });\r\n  }\r\n\r\n  async deleteNotification(notificationId: string, userId: string) {\r\n    const notification = await this.prisma.notification.findFirst({\r\n      where: { id: notificationId, userId },\r\n    });\r\n\r\n    if (!notification) {\r\n      throw new Error('Notification not found');\r\n    }\r\n\r\n    return this.prisma.notification.delete({\r\n      where: { id: notificationId },\r\n    });\r\n  }\r\n\r\n  async deleteAllNotifications(userId: string) {\r\n    return this.prisma.notification.deleteMany({\r\n      where: { userId },\r\n    });\r\n  }\r\n}\r\n"],"names":["NotificationService","getUserNotifications","userId","notifications","prisma","notification","findMany","where","orderBy","createdAt","take","markAsRead","notificationId","findFirst","id","Error","update","data","isRead","markAllAsRead","updateMany","createNotification","title","message","type","metadata","create","getUnreadCount","count","deleteNotification","delete","deleteAllNotifications","deleteMany"],"mappings":";;;;+BAIaA;;;eAAAA;;;wBAJc;+BACG;;;;;;;;;;AAGvB,IAAA,AAAMA,sBAAN,MAAMA;IAGX,MAAMC,qBAAqBC,MAAc,EAAE;QACzC,MAAMC,gBAAgB,MAAM,IAAI,CAACC,MAAM,CAACC,YAAY,CAACC,QAAQ,CAAC;YAC5DC,OAAO;gBAAEL;YAAO;YAChBM,SAAS;gBAAEC,WAAW;YAAO;YAC7BC,MAAM;QACR;QACA,OAAOP;IACT;IAEA,MAAMQ,WAAWC,cAAsB,EAAEV,MAAc,EAAE;QACvD,MAAMG,eAAe,MAAM,IAAI,CAACD,MAAM,CAACC,YAAY,CAACQ,SAAS,CAAC;YAC5DN,OAAO;gBAAEO,IAAIF;gBAAgBV;YAAO;QACtC;QAEA,IAAI,CAACG,cAAc;YACjB,MAAM,IAAIU,MAAM;QAClB;QAEA,OAAO,IAAI,CAACX,MAAM,CAACC,YAAY,CAACW,MAAM,CAAC;YACrCT,OAAO;gBAAEO,IAAIF;YAAe;YAC5BK,MAAM;gBAAEC,QAAQ;YAAK;QACvB;IACF;IAEA,MAAMC,cAAcjB,MAAc,EAAE;QAClC,OAAO,IAAI,CAACE,MAAM,CAACC,YAAY,CAACe,UAAU,CAAC;YACzCb,OAAO;gBAAEL;gBAAQgB,QAAQ;YAAM;YAC/BD,MAAM;gBAAEC,QAAQ;YAAK;QACvB;IACF;IAEA,MAAMG,mBACJnB,MAAc,EACdoB,KAAa,EACbC,OAAe,EACfC,OAAe,MAAM,EACrBC,QAAc,EACd;QACA,OAAO,IAAI,CAACrB,MAAM,CAACC,YAAY,CAACqB,MAAM,CAAC;YACrCT,MAAM;gBACJf;gBACAoB;gBACAC;gBACAC;gBACAC;YACF;QACF;IACF;IAEA,MAAME,eAAezB,MAAc,EAAmB;QACpD,OAAO,IAAI,CAACE,MAAM,CAACC,YAAY,CAACuB,KAAK,CAAC;YACpCrB,OAAO;gBAAEL;gBAAQgB,QAAQ;YAAM;QACjC;IACF;IAEA,MAAMW,mBAAmBjB,cAAsB,EAAEV,MAAc,EAAE;QAC/D,MAAMG,eAAe,MAAM,IAAI,CAACD,MAAM,CAACC,YAAY,CAACQ,SAAS,CAAC;YAC5DN,OAAO;gBAAEO,IAAIF;gBAAgBV;YAAO;QACtC;QAEA,IAAI,CAACG,cAAc;YACjB,MAAM,IAAIU,MAAM;QAClB;QAEA,OAAO,IAAI,CAACX,MAAM,CAACC,YAAY,CAACyB,MAAM,CAAC;YACrCvB,OAAO;gBAAEO,IAAIF;YAAe;QAC9B;IACF;IAEA,MAAMmB,uBAAuB7B,MAAc,EAAE;QAC3C,OAAO,IAAI,CAACE,MAAM,CAACC,YAAY,CAAC2B,UAAU,CAAC;YACzCzB,OAAO;gBAAEL;YAAO;QAClB;IACF;IA3EA,YAAY,AAAQE,MAAqB,CAAE;aAAvBA,SAAAA;IAAwB;AA4E9C"}