{"version":3,"sources":["../../../src/modules/support/support.controller.ts"],"sourcesContent":["import {\r\n  Controller,\r\n  Post,\r\n  Get,\r\n  Patch,\r\n  Delete,\r\n  Param,\r\n  Body,\r\n  UseGuards,\r\n  Request,\r\n  Query,\r\n} from '@nestjs/common';\r\nimport { JwtAuthGuard } from '@/common/guards/jwt-auth.guard';\r\nimport { RolesGuard } from '@/common/guards/roles.guard';\r\nimport { Roles } from '@/common/decorators/roles.decorator';\r\nimport { SupportService } from './support.service';\r\nimport { CreateTicketDto, UpdateTicketDto } from './dto/create-ticket.dto';\r\nimport { ContactFormDto } from './dto/contact-form.dto';\r\nimport { ApiOperation, ApiTags, ApiBearerAuth } from '@nestjs/swagger';\r\n\r\n@ApiTags('support')\r\n@Controller('support')\r\nexport class SupportController {\r\n  constructor(private supportService: SupportService) { }\r\n\r\n  /**\r\n   * Public: Submit a contact form (no auth required)\r\n   */\r\n  @Post('contact')\r\n  @ApiOperation({ summary: 'Submit a contact form (public, no auth required)' })\r\n  async submitContactForm(@Body() data: ContactFormDto) {\r\n    return this.supportService.createGuestTicket(data);\r\n  }\r\n\r\n  /**\r\n   * User: Create a support ticket\r\n   */\r\n  @ApiBearerAuth()\r\n  @Post('tickets')\r\n  @UseGuards(JwtAuthGuard)\r\n  @ApiOperation({ summary: 'Create a support ticket' })\r\n  async createTicket(@Request() req, @Body() data: CreateTicketDto) {\r\n    return this.supportService.createTicket(req.user.id, data);\r\n  }\r\n\r\n  /**\r\n   * User: Get all own tickets\r\n   */\r\n  @ApiBearerAuth()\r\n  @Get('tickets')\r\n  @UseGuards(JwtAuthGuard)\r\n  @ApiOperation({ summary: 'Get all user support tickets' })\r\n  async getUserTickets(@Request() req) {\r\n    return this.supportService.getUserTickets(req.user.id);\r\n  }\r\n\r\n  /**\r\n   * User: Get specific ticket\r\n   */\r\n  @ApiBearerAuth()\r\n  @Get('tickets/:id')\r\n  @UseGuards(JwtAuthGuard)\r\n  @ApiOperation({ summary: 'Get a specific support ticket' })\r\n  async getTicket(@Request() req, @Param('id') ticketId: string) {\r\n    return this.supportService.getTicket(req.user.id, ticketId);\r\n  }\r\n\r\n  /**\r\n   * Admin: Get all tickets\r\n   */\r\n  @ApiBearerAuth()\r\n  @Get('admin/tickets')\r\n  @UseGuards(JwtAuthGuard, RolesGuard)\r\n  @Roles('BANK_ADMIN', 'SUPER_ADMIN')\r\n  @ApiOperation({ summary: 'Get all support tickets (Admin only)' })\r\n  async getAllTickets(@Query('status') status?: string) {\r\n    return this.supportService.getAllTickets(status);\r\n  }\r\n\r\n  /**\r\n   * Admin: Get a specific ticket\r\n   */\r\n  @ApiBearerAuth()\r\n  @Get('admin/tickets/:id')\r\n  @UseGuards(JwtAuthGuard, RolesGuard)\r\n  @Roles('BANK_ADMIN', 'SUPER_ADMIN')\r\n  @ApiOperation({ summary: 'Get a specific support ticket (Admin only)' })\r\n  async getAdminTicket(@Param('id') ticketId: string) {\r\n    return this.supportService.getAdminTicket(ticketId);\r\n  }\r\n\r\n  /**\r\n   * Admin: Update ticket status\r\n   */\r\n  @ApiBearerAuth()\r\n  @Patch('admin/tickets/:id')\r\n  @UseGuards(JwtAuthGuard, RolesGuard)\r\n  @Roles('BANK_ADMIN', 'SUPER_ADMIN')\r\n  @ApiOperation({ summary: 'Update support ticket (Admin only)' })\r\n  async updateTicket(\r\n    @Request() req,\r\n    @Param('id') ticketId: string,\r\n    @Body() data: UpdateTicketDto,\r\n  ) {\r\n    return this.supportService.updateTicket(ticketId, req.user.id, data);\r\n  }\r\n\r\n  /**\r\n   * Admin: Delete ticket\r\n   */\r\n  @ApiBearerAuth()\r\n  @Delete('admin/tickets/:id')\r\n  @UseGuards(JwtAuthGuard, RolesGuard)\r\n  @Roles('BANK_ADMIN', 'SUPER_ADMIN')\r\n  @ApiOperation({ summary: 'Delete support ticket (Admin only)' })\r\n  async deleteTicket(@Request() req, @Param('id') ticketId: string) {\r\n    return this.supportService.deleteTicket(ticketId, req.user.id);\r\n  }\r\n\r\n  /**\r\n   * User: Add reply to ticket\r\n   */\r\n  @ApiBearerAuth()\r\n  @Post('tickets/:id/reply')\r\n  @UseGuards(JwtAuthGuard)\r\n  @ApiOperation({ summary: 'Add a reply to support ticket' })\r\n  async addUserReply(\r\n    @Request() req,\r\n    @Param('id') ticketId: string,\r\n    @Body() body: { message: string },\r\n  ) {\r\n    return this.supportService.addUserReply(req.user.id, ticketId, body.message);\r\n  }\r\n\r\n  /**\r\n   * Admin: Add reply to ticket\r\n   */\r\n  @ApiBearerAuth()\r\n  @Post('admin/tickets/:id/reply')\r\n  @UseGuards(JwtAuthGuard, RolesGuard)\r\n  @Roles('BANK_ADMIN', 'SUPER_ADMIN')\r\n  @ApiOperation({ summary: 'Add admin reply to support ticket (Admin only)' })\r\n  async addAdminReply(\r\n    @Request() req,\r\n    @Param('id') ticketId: string,\r\n    @Body() body: { message: string },\r\n  ) {\r\n    return this.supportService.addAdminReply(req.user.id, ticketId, body.message);\r\n  }\r\n\r\n  /**\r\n   * Admin: Send email reply to guest\r\n   */\r\n  @ApiBearerAuth()\r\n  @Post('admin/tickets/:id/email-reply')\r\n  @UseGuards(JwtAuthGuard, RolesGuard)\r\n  @Roles('BANK_ADMIN', 'SUPER_ADMIN')\r\n  @ApiOperation({ summary: 'Send email reply to guest contact (Admin only)' })\r\n  async sendGuestEmailReply(\r\n    @Request() req,\r\n    @Param('id') ticketId: string,\r\n    @Body() body: { guestEmail: string; guestName: string; subject: string; message: string },\r\n  ) {\r\n    return this.supportService.sendGuestEmailReply(ticketId, body, req.user);\r\n  }\r\n}\r\n\r\n"],"names":["SupportController","submitContactForm","data","supportService","createGuestTicket","createTicket","req","user","id","getUserTickets","getTicket","ticketId","getAllTickets","status","getAdminTicket","updateTicket","deleteTicket","addUserReply","body","message","addAdminReply","sendGuestEmailReply","summary"],"mappings":";;;;+BAsBaA;;;eAAAA;;;wBAXN;8BACsB;4BACF;gCACL;gCACS;iCACkB;gCAClB;yBACsB;;;;;;;;;;;;;;;AAI9C,IAAA,AAAMA,oBAAN,MAAMA;IAGX;;GAEC,GACD,MAEMC,kBAAkB,AAAQC,IAAoB,EAAE;QACpD,OAAO,IAAI,CAACC,cAAc,CAACC,iBAAiB,CAACF;IAC/C;IAEA;;GAEC,GACD,MAIMG,aAAa,AAAWC,GAAG,EAAE,AAAQJ,IAAqB,EAAE;QAChE,OAAO,IAAI,CAACC,cAAc,CAACE,YAAY,CAACC,IAAIC,IAAI,CAACC,EAAE,EAAEN;IACvD;IAEA;;GAEC,GACD,MAIMO,eAAe,AAAWH,GAAG,EAAE;QACnC,OAAO,IAAI,CAACH,cAAc,CAACM,cAAc,CAACH,IAAIC,IAAI,CAACC,EAAE;IACvD;IAEA;;GAEC,GACD,MAIME,UAAU,AAAWJ,GAAG,EAAE,AAAaK,QAAgB,EAAE;QAC7D,OAAO,IAAI,CAACR,cAAc,CAACO,SAAS,CAACJ,IAAIC,IAAI,CAACC,EAAE,EAAEG;IACpD;IAEA;;GAEC,GACD,MAKMC,cAAc,AAAiBC,MAAe,EAAE;QACpD,OAAO,IAAI,CAACV,cAAc,CAACS,aAAa,CAACC;IAC3C;IAEA;;GAEC,GACD,MAKMC,eAAe,AAAaH,QAAgB,EAAE;QAClD,OAAO,IAAI,CAACR,cAAc,CAACW,cAAc,CAACH;IAC5C;IAEA;;GAEC,GACD,MAKMI,aACJ,AAAWT,GAAG,EACd,AAAaK,QAAgB,EAC7B,AAAQT,IAAqB,EAC7B;QACA,OAAO,IAAI,CAACC,cAAc,CAACY,YAAY,CAACJ,UAAUL,IAAIC,IAAI,CAACC,EAAE,EAAEN;IACjE;IAEA;;GAEC,GACD,MAKMc,aAAa,AAAWV,GAAG,EAAE,AAAaK,QAAgB,EAAE;QAChE,OAAO,IAAI,CAACR,cAAc,CAACa,YAAY,CAACL,UAAUL,IAAIC,IAAI,CAACC,EAAE;IAC/D;IAEA;;GAEC,GACD,MAIMS,aACJ,AAAWX,GAAG,EACd,AAAaK,QAAgB,EAC7B,AAAQO,IAAyB,EACjC;QACA,OAAO,IAAI,CAACf,cAAc,CAACc,YAAY,CAACX,IAAIC,IAAI,CAACC,EAAE,EAAEG,UAAUO,KAAKC,OAAO;IAC7E;IAEA;;GAEC,GACD,MAKMC,cACJ,AAAWd,GAAG,EACd,AAAaK,QAAgB,EAC7B,AAAQO,IAAyB,EACjC;QACA,OAAO,IAAI,CAACf,cAAc,CAACiB,aAAa,CAACd,IAAIC,IAAI,CAACC,EAAE,EAAEG,UAAUO,KAAKC,OAAO;IAC9E;IAEA;;GAEC,GACD,MAKME,oBACJ,AAAWf,GAAG,EACd,AAAaK,QAAgB,EAC7B,AAAQO,IAAiF,EACzF;QACA,OAAO,IAAI,CAACf,cAAc,CAACkB,mBAAmB,CAACV,UAAUO,MAAMZ,IAAIC,IAAI;IACzE;IA7IA,YAAY,AAAQJ,cAA8B,CAAE;aAAhCA,iBAAAA;IAAkC;AA8IxD;;;;QAxIkBmB,SAAS;;;;;;;;;;;;;;QAWTA,SAAS;;;;;;;;;;;;;;;;QAWTA,SAAS;;;;;;;;;;;;;;QAWTA,SAAS;;;;;;;;;;;;;;;;;QAYTA,SAAS;;;;;;;;;;;;;;;QAYTA,SAAS;;;;;;;;;;;;;;;QAYTA,SAAS;;;;;;;;;;;;;;;;;;;QAgBTA,SAAS;;;;;;;;;;;;;;;;QAWTA,SAAS;;;;;;;;;;;;;;;;;;;QAgBTA,SAAS;;;;;;;;;;;;;;;;;;;QAgBTA,SAAS"}