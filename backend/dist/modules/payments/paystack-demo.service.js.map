{"version":3,"sources":["../../../src/modules/payments/paystack-demo.service.ts"],"sourcesContent":["import { Injectable, Logger, BadRequestException } from '@nestjs/common';\r\nimport { ConfigService } from '@nestjs/config';\r\nimport * as crypto from 'crypto';\r\nimport {\r\n  PaystackInitializePaymentDto,\r\n  PaystackInitializeResponse,\r\n  PaystackVerifyResponse,\r\n  PaystackBankListResponse,\r\n  PaystackResolveAccountDto,\r\n  PaystackResolveAccountResponse,\r\n  PaystackTransferRecipientDto,\r\n  PaystackTransferRecipientResponse,\r\n  PaystackInitiateTransferDto,\r\n  PaystackInitiateTransferResponse,\r\n} from './paystack.service';\r\n\r\n@Injectable()\r\nexport class PaystackDemoService {\r\n  private readonly logger = new Logger(PaystackDemoService.name);\r\n  private readonly secretKey: string;\r\n  private readonly baseUrl: string;\r\n\r\n  // Demo data storage\r\n  private demoPayments = new Map<string, any>();\r\n  private demoTransfers = new Map<string, any>();\r\n  private demoRecipients = new Map<string, any>();\r\n\r\n  constructor(private readonly configService: ConfigService) {\r\n    this.secretKey = 'demo-paystack-secret-key';\r\n    this.baseUrl = 'https://api.paystack.co';\r\n    this.logger.warn('ðŸŽ­ DEMO MODE: Using simulated Paystack service');\r\n  }\r\n\r\n  /**\r\n   * Initialize a payment transaction (Demo)\r\n   */\r\n  async initializePayment(data: PaystackInitializePaymentDto): Promise<PaystackInitializeResponse> {\r\n    this.logger.log(`ðŸŽ­ Demo: Initializing payment for ${data.email} - â‚¦${data.amount / 100}`);\r\n    \r\n    const reference = data.reference || this.generateReference('DEMO');\r\n    const accessCode = `ac_${Math.random().toString(36).substr(2, 12)}`;\r\n    \r\n    // Store demo payment data\r\n    this.demoPayments.set(reference, {\r\n      id: Math.floor(Math.random() * 100000),\r\n      email: data.email,\r\n      amount: data.amount,\r\n      reference,\r\n      status: 'pending',\r\n      created_at: new Date().toISOString(),\r\n      metadata: data.metadata,\r\n    });\r\n\r\n    return {\r\n      status: true,\r\n      message: 'Authorization URL created',\r\n      data: {\r\n        authorization_url: `https://checkout.paystack.com/demo/${accessCode}`,\r\n        access_code: accessCode,\r\n        reference,\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Verify a payment transaction (Demo)\r\n   */\r\n  async verifyPayment(reference: string): Promise<PaystackVerifyResponse> {\r\n    this.logger.log(`ðŸŽ­ Demo: Verifying payment ${reference}`);\r\n    \r\n    const payment = this.demoPayments.get(reference);\r\n    if (!payment) {\r\n      throw new BadRequestException('Payment not found');\r\n    }\r\n\r\n    // Simulate 80% success rate for demo\r\n    const isSuccess = Math.random() > 0.2;\r\n    const status = isSuccess ? 'success' : 'failed';\r\n    const gatewayResponse = isSuccess ? 'Successful' : 'Declined by bank';\r\n\r\n    // Update payment status\r\n    payment.status = status;\r\n    payment.paid_at = isSuccess ? new Date().toISOString() : null;\r\n    payment.gateway_response = gatewayResponse;\r\n\r\n    this.demoPayments.set(reference, payment);\r\n\r\n    return {\r\n      status: true,\r\n      message: 'Verification successful',\r\n      data: {\r\n        id: payment.id,\r\n        domain: 'test',\r\n        status,\r\n        reference,\r\n        amount: payment.amount,\r\n        message: null,\r\n        gateway_response: gatewayResponse,\r\n        paid_at: payment.paid_at || '',\r\n        created_at: payment.created_at,\r\n        channel: 'card',\r\n        currency: 'NGN',\r\n        ip_address: '127.0.0.1',\r\n        metadata: payment.metadata || {},\r\n        log: {},\r\n        fees: Math.floor(payment.amount * 0.015), // 1.5% fee\r\n        fees_split: null,\r\n        authorization: {\r\n          authorization_code: `auth_${Math.random().toString(36).substr(2, 12)}`,\r\n          bin: '408408',\r\n          last4: '4081',\r\n          exp_month: '12',\r\n          exp_year: '2030',\r\n          channel: 'card',\r\n          card_type: 'visa',\r\n          bank: 'TEST BANK',\r\n          country_code: 'NG',\r\n          brand: 'visa',\r\n          reusable: true,\r\n          signature: `sig_${Math.random().toString(36).substr(2, 12)}`,\r\n          account_name: null,\r\n        },\r\n        customer: {\r\n          id: Math.floor(Math.random() * 100000),\r\n          first_name: null,\r\n          last_name: null,\r\n          email: payment.email,\r\n          customer_code: `cus_${Math.random().toString(36).substr(2, 12)}`,\r\n          phone: null,\r\n          metadata: {},\r\n          risk_action: 'default',\r\n          international_format_phone: null,\r\n        },\r\n        plan: null,\r\n        split: {},\r\n        order_id: null,\r\n        paidAt: payment.paid_at || '',\r\n        createdAt: payment.created_at,\r\n        requested_amount: payment.amount,\r\n        pos_transaction_data: null,\r\n        source: null,\r\n        fees_breakdown: null,\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get list of banks (Demo)\r\n   */\r\n  async getBanks(): Promise<PaystackBankListResponse> {\r\n    this.logger.log('ðŸŽ­ Demo: Fetching Nigerian banks');\r\n    \r\n    const demoBanks = [\r\n      {\r\n        name: 'Access Bank',\r\n        slug: 'access-bank',\r\n        code: '044',\r\n        longcode: '044150149',\r\n        gateway: null,\r\n        pay_with_bank: true,\r\n        supports_transfer: true,\r\n        active: true,\r\n        country: 'Nigeria',\r\n        currency: 'NGN',\r\n        type: 'nuban',\r\n        is_deleted: false,\r\n        createdAt: '2016-07-14T10:04:29.000Z',\r\n        updatedAt: '2023-01-01T00:00:00.000Z',\r\n      },\r\n      {\r\n        name: 'GTBank',\r\n        slug: 'guaranty-trust-bank',\r\n        code: '058',\r\n        longcode: '058152036',\r\n        gateway: null,\r\n        pay_with_bank: true,\r\n        supports_transfer: true,\r\n        active: true,\r\n        country: 'Nigeria',\r\n        currency: 'NGN',\r\n        type: 'nuban',\r\n        is_deleted: false,\r\n        createdAt: '2016-07-14T10:04:29.000Z',\r\n        updatedAt: '2023-01-01T00:00:00.000Z',\r\n      },\r\n      {\r\n        name: 'First Bank of Nigeria',\r\n        slug: 'first-bank-of-nigeria',\r\n        code: '011',\r\n        longcode: '011151003',\r\n        gateway: null,\r\n        pay_with_bank: true,\r\n        supports_transfer: true,\r\n        active: true,\r\n        country: 'Nigeria',\r\n        currency: 'NGN',\r\n        type: 'nuban',\r\n        is_deleted: false,\r\n        createdAt: '2016-07-14T10:04:29.000Z',\r\n        updatedAt: '2023-01-01T00:00:00.000Z',\r\n      },\r\n      {\r\n        name: 'Zenith Bank',\r\n        slug: 'zenith-bank',\r\n        code: '057',\r\n        longcode: '057150013',\r\n        gateway: null,\r\n        pay_with_bank: true,\r\n        supports_transfer: true,\r\n        active: true,\r\n        country: 'Nigeria',\r\n        currency: 'NGN',\r\n        type: 'nuban',\r\n        is_deleted: false,\r\n        createdAt: '2016-07-14T10:04:29.000Z',\r\n        updatedAt: '2023-01-01T00:00:00.000Z',\r\n      },\r\n      {\r\n        name: 'UBA',\r\n        slug: 'united-bank-for-africa',\r\n        code: '033',\r\n        longcode: '033153513',\r\n        gateway: null,\r\n        pay_with_bank: true,\r\n        supports_transfer: true,\r\n        active: true,\r\n        country: 'Nigeria',\r\n        currency: 'NGN',\r\n        type: 'nuban',\r\n        is_deleted: false,\r\n        createdAt: '2016-07-14T10:04:29.000Z',\r\n        updatedAt: '2023-01-01T00:00:00.000Z',\r\n      },\r\n    ];\r\n\r\n    return {\r\n      status: true,\r\n      message: 'Banks retrieved',\r\n      data: demoBanks,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Resolve bank account details (Demo)\r\n   */\r\n  async resolveAccountNumber(data: PaystackResolveAccountDto): Promise<PaystackResolveAccountResponse> {\r\n    this.logger.log(`ðŸŽ­ Demo: Resolving account ${data.account_number} - ${data.bank_code}`);\r\n    \r\n    // Simulate account resolution with demo names\r\n    const demoNames = [\r\n      'John Doe',\r\n      'Jane Smith', \r\n      'David Johnson',\r\n      'Sarah Williams',\r\n      'Michael Brown',\r\n      'Emma Davis',\r\n      'James Wilson',\r\n      'Olivia Taylor',\r\n    ];\r\n\r\n    const randomName = demoNames[Math.floor(Math.random() * demoNames.length)];\r\n\r\n    return {\r\n      status: true,\r\n      message: 'Account number resolved',\r\n      data: {\r\n        account_number: data.account_number,\r\n        account_name: randomName.toUpperCase(),\r\n        bank_id: Math.floor(Math.random() * 1000) + 1,\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Create a transfer recipient (Demo)\r\n   */\r\n  async createTransferRecipient(data: PaystackTransferRecipientDto): Promise<PaystackTransferRecipientResponse> {\r\n    this.logger.log(`ðŸŽ­ Demo: Creating transfer recipient for ${data.name}`);\r\n    \r\n    const recipientCode = `rcp_${Math.random().toString(36).substr(2, 12)}`;\r\n    const recipientId = Math.floor(Math.random() * 100000);\r\n\r\n    const recipient = {\r\n      active: true,\r\n      createdAt: new Date().toISOString(),\r\n      currency: data.currency || 'NGN',\r\n      domain: 'test',\r\n      id: recipientId,\r\n      integration: 123456,\r\n      name: data.name,\r\n      recipient_code: recipientCode,\r\n      type: data.type,\r\n      updatedAt: new Date().toISOString(),\r\n      is_deleted: false,\r\n      isDeleted: false,\r\n      details: {\r\n        authorization_code: null,\r\n        account_number: data.account_number,\r\n        account_name: data.name,\r\n        bank_code: data.bank_code,\r\n        bank_name: 'DEMO BANK',\r\n      },\r\n    };\r\n\r\n    this.demoRecipients.set(recipientCode, recipient);\r\n\r\n    return {\r\n      status: true,\r\n      message: 'Transfer recipient created',\r\n      data: recipient,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Initiate a transfer (Demo)\r\n   */\r\n  async initiateTransfer(data: PaystackInitiateTransferDto): Promise<PaystackInitiateTransferResponse> {\r\n    this.logger.log(`ðŸŽ­ Demo: Initiating transfer of â‚¦${data.amount / 100} to ${data.recipient}`);\r\n    \r\n    const transferCode = `trf_${Math.random().toString(36).substr(2, 12)}`;\r\n    const transferId = Math.floor(Math.random() * 100000);\r\n\r\n    const transfer = {\r\n      integration: 123456,\r\n      domain: 'test',\r\n      amount: data.amount,\r\n      currency: 'NGN',\r\n      source: data.source,\r\n      reason: data.reason || 'Transfer',\r\n      recipient: parseInt(data.recipient.split('_')[1]) || 1,\r\n      status: 'pending',\r\n      transfer_code: transferCode,\r\n      id: transferId,\r\n      createdAt: new Date().toISOString(),\r\n      updatedAt: new Date().toISOString(),\r\n    };\r\n\r\n    this.demoTransfers.set(transferCode, transfer);\r\n\r\n    // Simulate transfer processing with 90% success rate\r\n    setTimeout(() => {\r\n      const isSuccess = Math.random() > 0.1;\r\n      transfer.status = isSuccess ? 'success' : 'failed';\r\n      this.demoTransfers.set(transferCode, transfer);\r\n      \r\n      this.logger.log(`ðŸŽ­ Demo: Transfer ${transferCode} ${isSuccess ? 'completed' : 'failed'}`);\r\n    }, 2000); // 2 second delay\r\n\r\n    return {\r\n      status: true,\r\n      message: 'Transfer has been queued',\r\n      data: transfer,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Verify webhook signature (Demo)\r\n   */\r\n  verifyWebhookSignature(payload: string, signature: string): boolean {\r\n    // In demo mode, always return true for webhook verification\r\n    this.logger.log('ðŸŽ­ Demo: Webhook signature verified (always true in demo mode)');\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Generate payment reference\r\n   */\r\n  generateReference(prefix = 'RDN'): string {\r\n    const timestamp = Date.now();\r\n    const random = Math.random().toString(36).substring(2, 8).toUpperCase();\r\n    return `${prefix}_${timestamp}_${random}`;\r\n  }\r\n\r\n  /**\r\n   * Convert amount to kobo (for Paystack)\r\n   */\r\n  toKobo(amount: number): number {\r\n    return Math.round(amount * 100);\r\n  }\r\n\r\n  /**\r\n   * Convert kobo to naira\r\n   */\r\n  fromKobo(kobo: number): number {\r\n    return kobo / 100;\r\n  }\r\n\r\n  /**\r\n   * Simulate webhook events for testing\r\n   */\r\n  async simulateWebhookEvent(reference: string, eventType: 'charge.success' | 'charge.failed' | 'transfer.success' | 'transfer.failed') {\r\n    this.logger.log(`ðŸŽ­ Demo: Simulating webhook event ${eventType} for ${reference}`);\r\n    \r\n    const payment = this.demoPayments.get(reference);\r\n    if (payment && (eventType === 'charge.success' || eventType === 'charge.failed')) {\r\n      return {\r\n        event: eventType,\r\n        data: {\r\n          id: payment.id,\r\n          domain: 'test',\r\n          status: eventType === 'charge.success' ? 'success' : 'failed',\r\n          reference,\r\n          amount: payment.amount,\r\n          message: null,\r\n          gateway_response: eventType === 'charge.success' ? 'Successful' : 'Declined',\r\n          paid_at: eventType === 'charge.success' ? new Date().toISOString() : '',\r\n          created_at: payment.created_at,\r\n          channel: 'card',\r\n          currency: 'NGN',\r\n          ip_address: '127.0.0.1',\r\n          metadata: payment.metadata || {},\r\n          fees: Math.floor(payment.amount * 0.015),\r\n          customer: {\r\n            id: Math.floor(Math.random() * 100000),\r\n            first_name: null,\r\n            last_name: null,\r\n            email: payment.email,\r\n            customer_code: `cus_${Math.random().toString(36).substr(2, 12)}`,\r\n            phone: null,\r\n            metadata: {},\r\n            risk_action: 'default',\r\n          },\r\n        },\r\n      };\r\n    }\r\n\r\n    // Return generic webhook data for transfers\r\n    return {\r\n      event: eventType,\r\n      data: {\r\n        id: Math.floor(Math.random() * 100000),\r\n        domain: 'test',\r\n        status: eventType.includes('success') ? 'success' : 'failed',\r\n        reference,\r\n        amount: 100000, // Demo amount\r\n        gateway_response: eventType.includes('success') ? 'Successful' : 'Failed',\r\n        created_at: new Date().toISOString(),\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get demo mode status info\r\n   */\r\n  getDemoInfo() {\r\n    return {\r\n      mode: 'demo',\r\n      totalPayments: this.demoPayments.size,\r\n      totalTransfers: this.demoTransfers.size,\r\n      totalRecipients: this.demoRecipients.size,\r\n      warning: 'This is demo mode. No real money transactions will occur.',\r\n    };\r\n  }\r\n}"],"names":["PaystackDemoService","initializePayment","data","logger","log","email","amount","reference","generateReference","accessCode","Math","random","toString","substr","demoPayments","set","id","floor","status","created_at","Date","toISOString","metadata","message","authorization_url","access_code","verifyPayment","payment","get","BadRequestException","isSuccess","gatewayResponse","paid_at","gateway_response","domain","channel","currency","ip_address","fees","fees_split","authorization","authorization_code","bin","last4","exp_month","exp_year","card_type","bank","country_code","brand","reusable","signature","account_name","customer","first_name","last_name","customer_code","phone","risk_action","international_format_phone","plan","split","order_id","paidAt","createdAt","requested_amount","pos_transaction_data","source","fees_breakdown","getBanks","demoBanks","name","slug","code","longcode","gateway","pay_with_bank","supports_transfer","active","country","type","is_deleted","updatedAt","resolveAccountNumber","account_number","bank_code","demoNames","randomName","length","toUpperCase","bank_id","createTransferRecipient","recipientCode","recipientId","recipient","integration","recipient_code","isDeleted","details","bank_name","demoRecipients","initiateTransfer","transferCode","transferId","transfer","reason","parseInt","transfer_code","demoTransfers","setTimeout","verifyWebhookSignature","payload","prefix","timestamp","now","substring","toKobo","round","fromKobo","kobo","simulateWebhookEvent","eventType","event","includes","getDemoInfo","mode","totalPayments","size","totalTransfers","totalRecipients","warning","configService","Logger","Map","secretKey","baseUrl","warn"],"mappings":"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"}