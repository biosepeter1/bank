{"version":3,"sources":["../../../src/modules/wallet/wallet.controller.ts"],"sourcesContent":["import { Controller, Get, Post, Body, UseGuards, Param } from '@nestjs/common';\r\nimport { ApiTags, ApiOperation, ApiBearerAuth, ApiResponse } from '@nestjs/swagger';\r\nimport { WalletService } from './wallet.service';\r\nimport { DepositDto, WithdrawDto, TransferDto } from './dto/wallet.dto';\r\nimport { JwtAuthGuard } from '../../common/guards/jwt-auth.guard';\r\nimport { RolesGuard } from '../../common/guards/roles.guard';\r\nimport { EmailVerifiedGuard } from '../../common/guards/email-verified.guard';\r\nimport { Roles } from '../../common/decorators/roles.decorator';\r\nimport { RequireEmailVerified } from '../../common/decorators/email-verified.decorator';\r\nimport { CurrentUser } from '../../common/decorators/current-user.decorator';\r\nimport { TransferLimitsService } from '../../common/services/transfer-limits.service';\r\n\r\n@ApiTags('wallet')\r\n@Controller('wallet')\r\n@UseGuards(JwtAuthGuard, EmailVerifiedGuard)\r\n@ApiBearerAuth()\r\nexport class WalletController {\r\n  constructor(\r\n    private readonly walletService: WalletService,\r\n    private readonly transferLimitsService: TransferLimitsService,\r\n  ) {}\r\n\r\n  @Get()\r\n  @ApiOperation({ summary: 'Get user wallet' })\r\n  @ApiResponse({ status: 200, description: 'Wallet retrieved successfully' })\r\n  getWallet(@CurrentUser() user: any) {\r\n    return this.walletService.getWallet(user.id);\r\n  }\r\n\r\n  @Get('balance')\r\n  @ApiOperation({ summary: 'Get wallet balance' })\r\n  @ApiResponse({ status: 200, description: 'Balance retrieved successfully' })\r\n  getBalance(@CurrentUser() user: any) {\r\n    return this.walletService.getBalance(user.id);\r\n  }\r\n\r\n  @Get('limits')\r\n  @ApiOperation({ summary: 'Get transfer limits and fees' })\r\n  @ApiResponse({ status: 200, description: 'Limits retrieved successfully' })\r\n  async getLimits(@CurrentUser() user: any) {\r\n    const [limits, fees] = await Promise.all([\r\n      this.transferLimitsService.getRemainingLimits(user.id),\r\n      Promise.resolve(this.transferLimitsService.getFeeInfo()),\r\n    ]);\r\n    return { limits, fees };\r\n  }\r\n\r\n  @Post('deposit')\r\n  @ApiOperation({ summary: 'Deposit money into wallet' })\r\n  @ApiResponse({ status: 201, description: 'Deposit successful' })\r\n  @ApiResponse({ status: 404, description: 'Wallet not found' })\r\n  deposit(@CurrentUser() user: any, @Body() depositDto: DepositDto) {\r\n    return this.walletService.deposit(user.id, depositDto);\r\n  }\r\n\r\n  @Post('withdraw')\r\n  @RequireEmailVerified()\r\n  @ApiOperation({ summary: 'Withdraw money from wallet' })\r\n  @ApiResponse({ status: 201, description: 'Withdrawal successful' })\r\n  @ApiResponse({ status: 400, description: 'Insufficient balance' })\r\n  @ApiResponse({ status: 404, description: 'Wallet not found' })\r\n  withdraw(@CurrentUser() user: any, @Body() withdrawDto: WithdrawDto) {\r\n    return this.walletService.withdraw(user.id, withdrawDto);\r\n  }\r\n\r\n  @Post('transfer')\r\n  @RequireEmailVerified()\r\n  @ApiOperation({ summary: 'Transfer money to another user' })\r\n  @ApiResponse({ status: 201, description: 'Transfer successful' })\r\n  @ApiResponse({ status: 400, description: 'Insufficient balance' })\r\n  @ApiResponse({ status: 404, description: 'Wallet not found' })\r\n  transfer(@CurrentUser() user: any, @Body() transferDto: TransferDto) {\r\n    return this.walletService.transfer(user.id, transferDto);\r\n  }\r\n\r\n  // Admin endpoints\r\n  @Post('admin/:userId/adjust')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('SUPER_ADMIN', 'BANK_ADMIN')\r\n  @ApiOperation({ summary: 'Adjust user balance (Admin only)' })\r\n  @ApiResponse({ status: 201, description: 'Balance adjusted successfully' })\r\n  @ApiResponse({ status: 400, description: 'Invalid request' })\r\n  @ApiResponse({ status: 404, description: 'User wallet not found' })\r\n  adminAdjustBalance(\r\n    @Param('userId') userId: string,\r\n    @CurrentUser() admin: any,\r\n    @Body() adjustDto: { amount: number; type: 'CREDIT' | 'DEBIT'; reason: string },\r\n  ) {\r\n    return this.walletService.adminAdjustBalance(\r\n      userId,\r\n      admin.id,\r\n      adjustDto.amount,\r\n      adjustDto.type,\r\n      adjustDto.reason,\r\n    );\r\n  }\r\n\r\n  @Post('admin/:userId/clear')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('SUPER_ADMIN', 'BANK_ADMIN')\r\n  @ApiOperation({ summary: 'Clear user account balance to zero (Admin only)' })\r\n  @ApiResponse({ status: 201, description: 'Account cleared successfully' })\r\n  @ApiResponse({ status: 400, description: 'Invalid request' })\r\n  @ApiResponse({ status: 404, description: 'User wallet not found' })\r\n  adminClearAccount(\r\n    @Param('userId') userId: string,\r\n    @CurrentUser() admin: any,\r\n    @Body() clearDto: { reason: string },\r\n  ) {\r\n    return this.walletService.adminClearAccount(\r\n      userId,\r\n      admin.id,\r\n      clearDto.reason,\r\n    );\r\n  }\r\n}\r\n"],"names":["WalletController","getWallet","user","walletService","id","getBalance","getLimits","limits","fees","Promise","all","transferLimitsService","getRemainingLimits","resolve","getFeeInfo","deposit","depositDto","withdraw","withdrawDto","transfer","transferDto","adminAdjustBalance","userId","admin","adjustDto","amount","type","reason","adminClearAccount","clearDto","summary","status","description"],"mappings":";;;;+BAgBaA;;;eAAAA;;;wBAhBiD;yBACI;+BACpC;2BACuB;8BACxB;4BACF;oCACQ;gCACb;wCACe;sCACT;uCACU;;;;;;;;;;;;;;;AAM/B,IAAA,AAAMA,mBAAN,MAAMA;IASXC,UAAU,AAAeC,IAAS,EAAE;QAClC,OAAO,IAAI,CAACC,aAAa,CAACF,SAAS,CAACC,KAAKE,EAAE;IAC7C;IAKAC,WAAW,AAAeH,IAAS,EAAE;QACnC,OAAO,IAAI,CAACC,aAAa,CAACE,UAAU,CAACH,KAAKE,EAAE;IAC9C;IAEA,MAGME,UAAU,AAAeJ,IAAS,EAAE;QACxC,MAAM,CAACK,QAAQC,KAAK,GAAG,MAAMC,QAAQC,GAAG,CAAC;YACvC,IAAI,CAACC,qBAAqB,CAACC,kBAAkB,CAACV,KAAKE,EAAE;YACrDK,QAAQI,OAAO,CAAC,IAAI,CAACF,qBAAqB,CAACG,UAAU;SACtD;QACD,OAAO;YAAEP;YAAQC;QAAK;IACxB;IAMAO,QAAQ,AAAeb,IAAS,EAAE,AAAQc,UAAsB,EAAE;QAChE,OAAO,IAAI,CAACb,aAAa,CAACY,OAAO,CAACb,KAAKE,EAAE,EAAEY;IAC7C;IAQAC,SAAS,AAAef,IAAS,EAAE,AAAQgB,WAAwB,EAAE;QACnE,OAAO,IAAI,CAACf,aAAa,CAACc,QAAQ,CAACf,KAAKE,EAAE,EAAEc;IAC9C;IAQAC,SAAS,AAAejB,IAAS,EAAE,AAAQkB,WAAwB,EAAE;QACnE,OAAO,IAAI,CAACjB,aAAa,CAACgB,QAAQ,CAACjB,KAAKE,EAAE,EAAEgB;IAC9C;IAEA,kBAAkB;IAQlBC,mBACE,AAAiBC,MAAc,EAC/B,AAAeC,KAAU,EACzB,AAAQC,SAAuE,EAC/E;QACA,OAAO,IAAI,CAACrB,aAAa,CAACkB,kBAAkB,CAC1CC,QACAC,MAAMnB,EAAE,EACRoB,UAAUC,MAAM,EAChBD,UAAUE,IAAI,EACdF,UAAUG,MAAM;IAEpB;IASAC,kBACE,AAAiBN,MAAc,EAC/B,AAAeC,KAAU,EACzB,AAAQM,QAA4B,EACpC;QACA,OAAO,IAAI,CAAC1B,aAAa,CAACyB,iBAAiB,CACzCN,QACAC,MAAMnB,EAAE,EACRyB,SAASF,MAAM;IAEnB;IAjGA,YACE,AAAiBxB,aAA4B,EAC7C,AAAiBQ,qBAA4C,CAC7D;aAFiBR,gBAAAA;aACAQ,wBAAAA;IAChB;AA+FL;;;;QA5FkBmB,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;;QAMzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;;QAMzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;;QAUzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;;QAOzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;;QAOzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;;;QASzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;;;;;QAkBzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa"}