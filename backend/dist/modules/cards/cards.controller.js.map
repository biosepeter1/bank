{"version":3,"sources":["../../../src/modules/cards/cards.controller.ts"],"sourcesContent":["import { Controller, Get, Post, Delete, Param, UseGuards, Body, Query } from '@nestjs/common';\r\nimport { ApiTags, ApiOperation, ApiBearerAuth } from '@nestjs/swagger';\r\nimport { CardsService } from './cards.service';\r\nimport { JwtAuthGuard } from '../../common/guards/jwt-auth.guard';\r\nimport { RolesGuard } from '../../common/guards/roles.guard';\r\nimport { Roles } from '../../common/decorators/roles.decorator';\r\nimport { CurrentUser } from '../../common/decorators/current-user.decorator';\r\n\r\n@ApiTags('cards')\r\n@Controller('cards')\r\n@UseGuards(JwtAuthGuard)\r\n@ApiBearerAuth()\r\nexport class CardsController {\r\n  constructor(private readonly cardsService: CardsService) {}\r\n\r\n  @Get()\r\n  @ApiOperation({ summary: 'Get user cards' })\r\n  getUserCards(@CurrentUser() user: any) {\r\n    return this.cardsService.getUserCards(user.id);\r\n  }\r\n\r\n  @Get('requests')\r\n  @ApiOperation({ summary: 'Get user card requests' })\r\n  getUserCardRequests(@CurrentUser() user: any) {\r\n    return this.cardsService.getUserCardRequests(user.id);\r\n  }\r\n\r\n  @Get(':id')\r\n  @ApiOperation({ summary: 'Get card by ID' })\r\n  getCard(@Param('id') id: string, @CurrentUser() user: any) {\r\n    return this.cardsService.getCardById(id, user.id);\r\n  }\r\n\r\n  @Post('create')\r\n  @ApiOperation({ summary: 'Request a new card' })\r\n  createCard(\r\n    @CurrentUser() user: any,\r\n    @Body() body: { cardType?: 'VIRTUAL' | 'PHYSICAL'; reason?: string }\r\n  ) {\r\n    return this.cardsService.createVirtualCard(user.id, body.cardType, body.reason);\r\n  }\r\n\r\n  // User block/unblock actions\r\n  @Post(':id/block')\r\n  @ApiOperation({ summary: 'Block own card' })\r\n  blockOwnCard(@Param('id') id: string, @CurrentUser() user: any) {\r\n    return this.cardsService.userBlockCard(id, user.id);\r\n  }\r\n\r\n  @Post(':id/unblock')\r\n  @ApiOperation({ summary: 'Unblock own card' })\r\n  unblockOwnCard(@Param('id') id: string, @CurrentUser() user: any) {\r\n    return this.cardsService.userUnblockCard(id, user.id);\r\n  }\r\n\r\n  @Get(':id/pan')\r\n  @ApiOperation({ summary: 'Securely reveal full virtual card PAN (demo)' })\r\n  getPan(@Param('id') id: string, @CurrentUser() user: any) {\r\n    return this.cardsService.userGetPan(id, user.id);\r\n  }\r\n\r\n  // Admin endpoints\r\n  @Get('admin/requests')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('BANK_ADMIN', 'SUPER_ADMIN')\r\n  @ApiOperation({ summary: 'Get all card requests (Admin only)' })\r\n  getAllCardRequests(@Query('status') status?: string) {\r\n    return this.cardsService.getAllCardRequests(status);\r\n  }\r\n\r\n  @Post('admin/requests/:id/approve')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('BANK_ADMIN', 'SUPER_ADMIN')\r\n  @ApiOperation({ summary: 'Approve card request (Admin only)' })\r\n  approveCardRequest(@Param('id') id: string, @CurrentUser() admin: any) {\r\n    return this.cardsService.approveCardRequest(id, admin.id);\r\n  }\r\n\r\n  // User: Fund card from wallet balance\r\n  @Post(':id/fund')\r\n  @ApiOperation({ summary: 'Fund card from user wallet' })\r\n  fundOwnCard(\r\n    @Param('id') id: string,\r\n    @CurrentUser() user: any,\r\n    @Body() body: { amount: number }\r\n  ) {\r\n    return this.cardsService.userFundCard(id, user.id, Number(body.amount || 0));\r\n  }\r\n\r\n  // User: Withdraw from card back to wallet\r\n  @Post(':id/withdraw')\r\n  @ApiOperation({ summary: 'Withdraw funds from card back to wallet' })\r\n  withdrawOwnCard(\r\n    @Param('id') id: string,\r\n    @CurrentUser() user: any,\r\n    @Body() body: { amount: number }\r\n  ) {\r\n    return this.cardsService.userWithdrawFromCard(id, user.id, Number(body.amount || 0));\r\n  }\r\n\r\n  @Post('admin/requests/:id/reject')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('BANK_ADMIN', 'SUPER_ADMIN')\r\n  @ApiOperation({ summary: 'Reject card request (Admin only)' })\r\n  rejectCardRequest(\r\n    @Param('id') id: string,\r\n    @CurrentUser() admin: any,\r\n    @Body() body: { reason: string }\r\n  ) {\r\n    return this.cardsService.rejectCardRequest(id, admin.id, body.reason);\r\n  }\r\n\r\n  @Get('admin/all')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('BANK_ADMIN', 'SUPER_ADMIN')\r\n  @ApiOperation({ summary: 'Get all cards (Admin only)' })\r\n  getAllCards() {\r\n    return this.cardsService.getAllCards();\r\n  }\r\n\r\n  @Post('admin/:id/block')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('BANK_ADMIN', 'SUPER_ADMIN')\r\n  @ApiOperation({ summary: 'Block a card (Admin only)' })\r\n  blockCard(@Param('id') id: string, @CurrentUser() admin: any) {\r\n    return this.cardsService.blockCard(id, admin.id);\r\n  }\r\n\r\n  @Post('admin/:id/unblock')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('BANK_ADMIN', 'SUPER_ADMIN')\r\n  @ApiOperation({ summary: 'Unblock a card (Admin only)' })\r\n  unblockCard(@Param('id') id: string, @CurrentUser() admin: any) {\r\n    return this.cardsService.unblockCard(id, admin.id);\r\n  }\r\n\r\n  @Delete('admin/:id')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('BANK_ADMIN', 'SUPER_ADMIN')\r\n  @ApiOperation({ summary: 'Delete a card (Admin only)' })\r\n  deleteCard(@Param('id') id: string, @CurrentUser() admin: any) {\r\n    return this.cardsService.deleteCard(id, admin.id);\r\n  }\r\n}\r\n"],"names":["CardsController","getUserCards","user","cardsService","id","getUserCardRequests","getCard","getCardById","createCard","body","createVirtualCard","cardType","reason","blockOwnCard","userBlockCard","unblockOwnCard","userUnblockCard","getPan","userGetPan","getAllCardRequests","status","approveCardRequest","admin","fundOwnCard","userFundCard","Number","amount","withdrawOwnCard","userWithdrawFromCard","rejectCardRequest","getAllCards","blockCard","unblockCard","deleteCard","summary"],"mappings":"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"}