{"version":3,"sources":["../../../src/modules/otp/otp.controller.ts"],"sourcesContent":["import { Body, Controller, Post, UseGuards } from '@nestjs/common';\r\nimport { ApiBearerAuth, ApiOperation, ApiTags } from '@nestjs/swagger';\r\nimport { OtpService } from './otp.service';\r\nimport { JwtAuthGuard } from '../../common/guards/jwt-auth.guard';\r\nimport { CurrentUser } from '../../common/decorators/current-user.decorator';\r\n\r\nimport { IsIn, IsObject, IsOptional, IsString } from 'class-validator';\r\n\r\nclass StartOtpDto {\r\n  @IsOptional()\r\n  @IsString()\r\n  @IsIn(['TRANSFER', 'LOGIN', 'WITHDRAWAL'])\r\n  purpose?: 'TRANSFER' | 'LOGIN' | 'WITHDRAWAL';\r\n\r\n  @IsOptional()\r\n  @IsObject()\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\nclass VerifyOtpDto {\r\n  @IsString()\r\n  otpId: string;\r\n\r\n  @IsString()\r\n  code: string; // 6 digits\r\n}\r\n\r\n@ApiTags('otp')\r\n@ApiBearerAuth()\r\n@UseGuards(JwtAuthGuard)\r\n@Controller('otp')\r\nexport class OtpController {\r\n  constructor(private readonly otpService: OtpService) {}\r\n\r\n  @Post('start')\r\n  @ApiOperation({ summary: 'Start an OTP flow (email-based)' })\r\n  async start(@CurrentUser() user: any, @Body() dto: StartOtpDto) {\r\n    const result = await this.otpService.start(user.id, dto.purpose || 'TRANSFER', dto.metadata);\r\n    return result; // { otpId, expiresIn }\r\n  }\r\n\r\n  @Post('verify')\r\n  @ApiOperation({ summary: 'Verify an OTP code' })\r\n  async verify(@CurrentUser() user: any, @Body() dto: VerifyOtpDto) {\r\n    return this.otpService.verify(user.id, dto.otpId, dto.code);\r\n  }\r\n}\r\n"],"names":["OtpController","StartOtpDto","VerifyOtpDto","start","user","dto","result","otpService","id","purpose","metadata","verify","otpId","code","summary"],"mappings":";;;;+BA+BaA;;;eAAAA;;;wBA/BqC;yBACG;4BAC1B;8BACE;sCACD;gCAEyB;;;;;;;;;;;;;;;AAErD,IAAA,AAAMC,cAAN,MAAMA;AASN;;;;;QANS;QAAY;QAAS;;;;;;;;;AAQ9B,IAAA,AAAMC,eAAN,MAAMA;AAMN;;;;;;;;;AAMO,IAAA,AAAMF,gBAAN,MAAMA;IAGX,MAEMG,MAAM,AAAeC,IAAS,EAAE,AAAQC,GAAgB,EAAE;QAC9D,MAAMC,SAAS,MAAM,IAAI,CAACC,UAAU,CAACJ,KAAK,CAACC,KAAKI,EAAE,EAAEH,IAAII,OAAO,IAAI,YAAYJ,IAAIK,QAAQ;QAC3F,OAAOJ,QAAQ,uBAAuB;IACxC;IAEA,MAEMK,OAAO,AAAeP,IAAS,EAAE,AAAQC,GAAiB,EAAE;QAChE,OAAO,IAAI,CAACE,UAAU,CAACI,MAAM,CAACP,KAAKI,EAAE,EAAEH,IAAIO,KAAK,EAAEP,IAAIQ,IAAI;IAC5D;IAbA,YAAY,AAAiBN,UAAsB,CAAE;aAAxBA,aAAAA;IAAyB;AAcxD;;;;QAXkBO,SAAS;;;;;;;;;;;;;;QAOTA,SAAS"}