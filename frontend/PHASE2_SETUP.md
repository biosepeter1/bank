# Phase 2: State Management & API Integration\n\n## Overview\nCompleted the foundational infrastructure for the dashboard including state management with Zustand, API services, common components, and type definitions.\n\n## âœ… Completed in Phase 2\n\n### 1. Type Definitions (`src/stores/types.ts`)\n- âœ… User & Authentication types\n- âœ… Account types\n- âœ… Transaction types with filtering\n- âœ… Transfer & Beneficiary types\n- âœ… Card types\n- âœ… Deposit types\n- âœ… Currency & Exchange types\n- âœ… Loan types\n- âœ… Settings & Notification types\n- âœ… API Response types\n\n### 2. Zustand Store Management\n- âœ… **useUserStore** - User profile, accounts, notifications\n- âœ… **useTransactionStore** - Transactions, transfers, beneficiaries with filtering\n- âœ… **useFinanceStore** - Cards, deposits, currency rates, loans, savings goals\n\n### 3. API Service Layer (`src/services/`)\n- âœ… Axios configuration with interceptors\n- âœ… Request/Response interceptors with auth token handling\n- âœ… Error handling with custom ApiError type\n- âœ… API service methods organized by domain:\n  - Auth endpoints (login, signup, logout)\n  - User endpoints (profile, accounts, settings)\n  - Transaction endpoints (list, details, export)\n  - Transfer endpoints (create, beneficiary management)\n  - Card endpoints (CRUD, freeze, unfreeze)\n  - Deposit endpoints\n  - Currency endpoints (rates, conversion)\n  - Loan endpoints (apply, payments)\n  - Savings goals endpoints\n\n### 4. Common Components\n- âœ… **Modal** - Reusable modal dialog\n- âœ… **ConfirmDialog** - Confirmation modal\n- âœ… **Toast** - Toast notification with auto-dismiss\n- âœ… **ToastContainer** - Toast display container\n- âœ… **useToast Hook** - Toast management hook\n\n## ğŸ“ Project Structure (Phase 2)\n\n```\nsrc/\nâ”œâ”€â”€ stores/\nâ”‚   â”œâ”€â”€ types.ts                    # All type definitions\nâ”‚   â”œâ”€â”€ useUserStore.ts             # User state management\nâ”‚   â”œâ”€â”€ useTransactionStore.ts      # Transaction & transfer state\nâ”‚   â”œâ”€â”€ useFinanceStore.ts          # Cards, deposits, loans state\nâ”‚   â””â”€â”€ index.ts                    # Store exports\nâ”œâ”€â”€ services/\nâ”‚   â”œâ”€â”€ api.ts                      # Axios configuration & interceptors\nâ”‚   â”œâ”€â”€ apiService.ts               # API endpoints\nâ”‚   â””â”€â”€ index.ts                    # Service exports\nâ”œâ”€â”€ components/\nâ”‚   â”œâ”€â”€ common/                     # Reusable components\nâ”‚   â”‚   â”œâ”€â”€ Modal.tsx\nâ”‚   â”‚   â”œâ”€â”€ Toast.tsx\nâ”‚   â”‚   â””â”€â”€ index.ts\nâ”‚   â””â”€â”€ dashboard/                  # Dashboard (from Phase 1)\n```\n\n## ğŸ”„ Data Flow Architecture\n\n```\nComponent\n   â†“\nUse Store Hook (useUserStore, useTransactionStore, etc.)\n   â†“\nStore Action\n   â†“\nOptional API Call (via apiService)\n   â†“\nUpdate Store State\n   â†“\nComponent Re-renders\n```\n\n## ğŸ“š Usage Examples\n\n### Using Stores\n\n```typescript\nimport { useUserStore, useTransactionStore } from '@/stores';\n\nfunction MyComponent() {\n  const { user, setUser, addNotification } = useUserStore();\n  const { transactions, filterTransactions } = useTransactionStore();\n  \n  // Fetch user from API\n  const fetchUser = async () => {\n    try {\n      const user = await userService.getProfile();\n      setUser(user);\n    } catch (error) {\n      console.error(error);\n    }\n  };\n  \n  // Filter transactions\n  const filtered = filterTransactions({\n    type: 'debit',\n    status: 'completed',\n  });\n  \n  return <div>{user?.firstName}</div>;\n}\n```\n\n### Using API Services\n\n```typescript\nimport { transactionService, userService } from '@/services';\n\nasync function handleTransfer() {\n  try {\n    const transfer = await transferService.createTransfer({\n      amount: 500,\n      recipientAccount: '1234567890',\n      type: 'local',\n    });\n    console.log('Transfer created:', transfer);\n  } catch (error) {\n    console.error('Transfer failed:', error);\n  }\n}\n```\n\n### Using Toast Notifications\n\n```typescript\nimport { useToast } from '@/components/common';\n\nfunction MyComponent() {\n  const { success, error, warning, toasts, removeToast } = useToast();\n  \n  const handleAction = async () => {\n    try {\n      // Do something\n      success('Action completed successfully!');\n    } catch (err) {\n      error('Something went wrong');\n    }\n  };\n  \n  return (\n    <>\n      <button onClick={handleAction}>Action</button>\n      <ToastContainer toasts={toasts} onRemove={removeToast} />\n    </>\n  );\n}\n```\n\n### Using Modal\n\n```typescript\nimport { Modal, ConfirmDialog } from '@/components/common';\nimport { useState } from 'react';\n\nfunction MyComponent() {\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [isConfirming, setIsConfirming] = useState(false);\n  \n  return (\n    <>\n      <button onClick={() => setIsModalOpen(true)}>Open Modal</button>\n      \n      <Modal\n        isOpen={isModalOpen}\n        title=\"My Modal\"\n        onClose={() => setIsModalOpen(false)}\n        size=\"lg\"\n      >\n        <p>Modal content goes here</p>\n      </Modal>\n      \n      <ConfirmDialog\n        isOpen={isConfirming}\n        title=\"Confirm Action\"\n        message=\"Are you sure?\"\n        onConfirm={() => {\n          // Handle confirm\n          setIsConfirming(false);\n        }}\n        onCancel={() => setIsConfirming(false)}\n      />\n    </>\n  );\n}\n```\n\n## ğŸ” Authentication Flow\n\n```typescript\n// Login flow\n1. User submits login form\n2. authService.login(email, password)\n3. API returns { user, token }\n4. Store token in localStorage\n5. API interceptor adds token to all requests\n6. useUserStore.setUser(user)\n7. Redirect to dashboard\n\n// Logout flow\n1. authService.logout()\n2. Clear localStorage\n3. useUserStore.logout()\n4. Redirect to login\n```\n\n## ğŸ›¡ï¸ Error Handling\n\n```typescript\n// API errors are automatically handled\ntry {\n  const data = await transactionService.getTransactions();\n} catch (error) {\n  // error is ApiError type\n  // {\n  //   status: 400,\n  //   message: 'Invalid request',\n  //   code: 'VALIDATION_ERROR',\n  //   details: { ... }\n  // }\n}\n\n// 401 Unauthorized automatically clears auth and redirects\n// Other errors can be caught and handled in components\n```\n\n## ğŸ”„ State Update Patterns\n\n### Direct State Updates\n```typescript\nconst { setUser, setAccounts } = useUserStore();\n\nsetUser(newUser);\nsetAccounts(newAccounts);\n```\n\n### Add/Update Operations\n```typescript\nconst { addTransaction, updateCard } = useFinanceStore();\n\naddTransaction(newTransaction);\nupdateCard(updatedCard);\n```\n\n### Filtering Operations\n```typescript\nconst { filterTransactions } = useTransactionStore();\n\nconst results = filterTransactions({\n  type: 'debit',\n  status: 'completed',\n  minAmount: 100,\n  maxAmount: 1000,\n  searchQuery: 'restaurant',\n});\n```\n\n## ğŸ“ Environment Variables\n\nCreate `.env.local` in the frontend root:\n\n```env\nREACT_APP_API_URL=http://localhost:3001/api\nREACT_APP_ENV=development\n```\n\n## ğŸš€ Next Steps (Phase 3)\n\n### Immediate Tasks\n1. Create Loading & Error state components\n2. Build Skeleton loaders\n3. Implement form validation utilities\n4. Create Layout provider for app-wide state\n\n### Component Development\n1. Create Loader/Spinner component\n2. Build Skeleton component for data loading\n3. Create Error boundary\n4. Build Empty state component\n\n### Feature Implementation\n1. Integrate stores with dashboard pages\n2. Add loading states to API calls\n3. Implement error notifications\n4. Add form validation\n\n### Testing Setup\n1. Setup Jest for unit tests\n2. Create store tests\n3. Create component tests\n4. Setup integration tests\n\n## ğŸ“Š Store Interaction Map\n\n```\nUserStore\nâ”œâ”€â”€ User Profile\nâ”œâ”€â”€ Accounts (multiple)\nâ”œâ”€â”€ Settings\nâ”œâ”€â”€ Notifications\nâ””â”€â”€ Loading/Error State\n\nTransactionStore\nâ”œâ”€â”€ Transactions List\nâ”œâ”€â”€ Transfers List\nâ”œâ”€â”€ Beneficiaries\nâ”œâ”€â”€ Filter Logic\nâ””â”€â”€ Search Logic\n\nFinanceStore\nâ”œâ”€â”€ Cards\nâ”œâ”€â”€ Card Transactions\nâ”œâ”€â”€ Deposits\nâ”œâ”€â”€ Exchange Rates\nâ”œâ”€â”€ Loans\nâ”œâ”€â”€ Loan Payments\nâ”œâ”€â”€ Savings Goals\nâ””â”€â”€ Loading/Error State\n```\n\n## ğŸ”— Service Layers\n\n```\napiService (layer 1: API calls)\n    â†“\nStore Actions (layer 2: State updates)\n    â†“\nComponents (layer 3: UI)\n    â†“\nUser\n```\n\n## ğŸ¯ Best Practices\n\n1. **Always use stores for global state** - Don't lift state manually\n2. **Type safety** - Use TypeScript types from stores/types.ts\n3. **Error handling** - Always wrap API calls in try-catch\n4. **Loading states** - Use isLoading flag from stores\n5. **Notifications** - Use useToast for user feedback\n6. **Data validation** - Validate before API calls\n\n## ğŸ“‹ Checklist for Integration\n\n- [ ] Install required dependencies\n- [ ] Configure environment variables\n- [ ] Test API connection\n- [ ] Implement auth flow\n- [ ] Connect dashboard pages to stores\n- [ ] Add loading states\n- [ ] Add error handling\n- [ ] Test all stores\n- [ ] Test API services\n- [ ] Create mock data for development\n\n## ğŸ”— File Dependencies\n\n```\nComponents\n  â†“\nCommon Components (Modal, Toast)\n  â†“\nStores (useUserStore, useTransactionStore, useFinanceStore)\n  â†“\nAPI Services (apiService)\n  â†“\nAPI Instance (axios with interceptors)\n  â†“\nTypes (stores/types.ts)\n```\n\n---\n\n**Status**: âœ… Phase 2 Complete - Ready for component integration\n**Next**: Phase 3 - Component Integration & Advanced Features\n"